# Web Audio 声波聊天演示

这是一个零依赖的浏览器实验，通过 **Web Audio API** 将文本编码成声波发送，再在另一端解码成字符串，实现“声波聊天”。无需 ChirpJS、后端服务或网络连接，只要两台设备能够互相听到即可。

## 目录结构

```
.
├── index.html                # 入口页面，包含 UI 与操作按钮
├── assets
│   ├── css
│   │   └── styles.css        # 页面样式
│   └── js
│       ├── audio-modem.js    # 纯原生音频编解码实现
│       └── main.js           # UI 逻辑与事件绑定
└── README.md
```

## 工作原理简述

- 文本通过 `TextEncoder` 转成 UTF-8 字节。
- 每个字节分成若干符号（默认 4 bits/符号），映射到不同的载波频率，类似 FSK 调制。
- 通过 `AudioContext` 合成包头、数据段、包尾（起止字节为 STX=0x02、ETX=0x03）的波形，送入扬声器播放。
- 另一端使用麦克风采集，通过 `AnalyserNode + Goertzel` 算法检测每个符号对应的频率，再还原成字节并转回字符串。

## 快速开始

1. 在项目根目录启动任意静态服务器（示例命令）：

   ```bash
   # 使用 Node.js
   npx serve

   # 或使用 Python 3
   python -m http.server 8000
   ```

2. 浏览器访问提示的本地地址（例如 `http://localhost:3000/`）。
3. 在 **每个** 客户端页面点击「启用音频」，允许麦克风权限并开始监听。
4. 使用「频段选择」下拉框切换合适的声波通道（默认推荐标准频段）。
5. 将两台设备或两个浏览器标签的扬声器与麦克风距离保持在 20~40 厘米，并尽量选择安静环境。
6. 输入文本并点击「发送」，另一端成功解码后会在消息面板中显示内容。

## 频段预设

| 选项 | 载波范围（约） | 使用建议 |
| ---- | --------------- | -------- |
| 标准（1.5–2.8 kHz） | 1.5–3.4 kHz | 最稳定，对设备要求最低，建议初次体验使用。 |
| 高频（8–10 kHz） | 8.2–11.0 kHz | 相对安静，但部分扬声器会削弱高频，需保持设备靠近并适当调高音量。 |
| 近超声（17–19 kHz） | 17.5–20.2 kHz | 接近静音，对降噪/硬件更敏感；建议降低音量、发送简短消息，并在安静环境测试。 |

> ⚠️ 以上频段的声压级均在常规安全范围内，不会对人体造成伤害。但长时间高音量播放可能让宠物或部分人群感到不适，尤其是近超声模式。请控制音量（建议 < 70 dB）、缩短发送时长，并在开阔环境下测试。

## 手动验证清单

- **回环测试**：同一台电脑开两个窗口，相互发送一段 10~20 字符的文本，确认可以解码。
- **跨设备测试**：用手机 + 电脑互发，观察是否存在明显丢字或乱码。
- **噪声环境**：打开背景音乐或风扇，查看误码率是否升高；必要时靠近设备、降低音量干扰，或切回标准频段。
- **频繁发送**：连续发送多条短消息，验证队列不会卡住，日志顺序正确。

## 常见限制

- 受硬件与环境影响较大：噪声、回声消除、麦克风灵敏度都会影响接收成功率。
- 当前实现仅提供基础差错防护，若误码率较高，可尝试缩短消息、增大符号间隔、切换更稳定的频段，或调整 `audio-modem.js` 中的参数。
- 浏览器需支持 `TextEncoder`/`TextDecoder` 与 Web Audio API（现代桌面/移动浏览器基本覆盖）。
- 没有做数据加密或身份验证，适合实验用途；若需安全性，请自行扩展协议。

## 可拓展方向

- 引入前向纠错、CRC 校验或包序号，降低误码和串包概率。
- 在 UI 中显示实时频谱或信噪比，帮助调试不同环境下的表现。
- 增加消息重发、发送进度条、音量校准等交互，提升可用性。
- 尝试多频叠加或正交调制以提升带宽，或使用超声频段减小扰民。
